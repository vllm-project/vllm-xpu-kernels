
#include "cutlass/epilogue/collective/default_epilogue.hpp"
#include "cutlass/gemm/device/gemm_universal_adapter.h"
#include "flash_attention_v2/collective/fmha_fusion.hpp"
#include "cutlass/util/packed_stride.hpp"
#include "cutlass/util/GPU_Clock.hpp"
#include "cutlass/util/sycl_event_manager.hpp"
#include <cute/tensor.hpp>
#include <random>

#include "cutlass/util/command_line.h"
#include "cutlass/util/device_memory.h"
#include "cutlass/util/reference/device/gemm_complex.h"
#include "cutlass/util/reference/device/tensor_compare.h"

#include <sycl/ext/intel/experimental/grf_size_properties.hpp>

#include "collective/chunk_prefill_scheduler.hpp"
#include "collective/chunk_prefill_epilogue.hpp"
#include "kernel/chunk_prefill_kernel.hpp"
#include "chunk_prefill.hpp"
#include "fmha_utils.hpp"

using namespace cute;

// clang-format off
// macros to be filled in CMake
#define IMPL_T ${IMPL_T}
#define IMPL_KV_T ${IMPL_KV_T}
#define IMPL_POLICY ${IMPL_POLICY}
#cmakedefine01 IMPL_KISPAGED
#cmakedefine01 IMPL_KISCAUSAL
#cmakedefine01 IMPL_KISSINK
#cmakedefine01 IMPL_KISLOCAL
// clang-format on

#define INSTANTIATE_KERNEL() \
  template void policy_dispatch< \
  IMPL_POLICY, \
  static_cast<bool>(IMPL_KISPAGED), \
  static_cast<bool>(IMPL_KISCAUSAL), \
  static_cast<bool>(IMPL_KISLOCAL), \
  static_cast<bool>(IMPL_KISSINK)>(sycl::queue& queue, CutlassType cuType, const chunk_prefill_args_t& args);

INSTANTIATE_KERNEL()
