
#include "cutlass/epilogue/collective/default_epilogue.hpp"
#include "cutlass/gemm/device/gemm_universal_adapter.h"
#include "flash_attention_v2/collective/fmha_fusion.hpp"
#include "cutlass/util/packed_stride.hpp"
#include "cutlass/util/GPU_Clock.hpp"
#include "cutlass/util/sycl_event_manager.hpp"
#include <cute/tensor.hpp>
#include <random>

#include "cutlass/util/command_line.h"
#include "cutlass/util/device_memory.h"
#include "cutlass/util/reference/device/gemm_complex.h"
#include "cutlass/util/reference/device/tensor_compare.h"

#include <sycl/ext/intel/experimental/grf_size_properties.hpp>

#include "collective/chunk_prefill_scheduler.hpp"
#include "collective/chunk_prefill_epilogue.hpp"
#include "kernel/paged_decode_kernel.hpp"
#include "paged_decode.hpp"
#include "fmha_utils.hpp"

using namespace cute;

// clang-format off
// macros to be filled in CMake
#define IMPL_POLICY ${IMPL_POLICY}
#define IMPL_QGROUP ${IMPL_QGROUP}
#define IMPL_HEADSIZE ${IMPL_HEADSIZE}
#cmakedefine01 IMPL_KISCAUSAL
#cmakedefine01 IMPL_KISLOCAL
#cmakedefine01 IMPL_KISSINK
// clang-format on

#define INSTANTIATE_KERNEL() \
  template void decode_policy_dispatch< \
  decode_policy_qpacked_head<IMPL_QGROUP, IMPL_HEADSIZE>, \
  static_cast<bool>(IMPL_KISCAUSAL), \
  static_cast<bool>(IMPL_KISLOCAL), \
  static_cast<bool>(IMPL_KISSINK)>(sycl::queue& queue, CutlassType cuType, const paged_decode_args_t& args);

INSTANTIATE_KERNEL()
